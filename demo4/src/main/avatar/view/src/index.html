<!DOCTYPE html>
<html>
    <head>
        <title>Person Service</title>
        <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"/>
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js" type="text/javascript"></script>
        <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/app.css" rel="stylesheet">
    </head>
    <body>
        <script data-model="rest" id="Person">
            var Person = function(collection) {
                this.id = null;
                this.firstName = '';
                this.lastName = '';
                this.twitter = '';
                this.github = '';

                this.clear = function() {
                    this.id = null;
                    this.firstName = this.lastName = this.twitter = this.github = "";
                };

                this.save = function() {
                    this.$put();
                    avatar.navigateTo('#list');
                };

                this.$onPutDone = function() {
                    collection.$get();
                };

                this.$onDeleteDone = function() {
                    collection.$get();
                };

            }
        </script>
        <script data-model="rest" id="People">
            var People = function() {
                this.tmpl = function(person) {
                    var template = _.template("<tr>" +
                            "<td><input type='checkbox' name='id' value='<%= id %>'></td>" +
                            "<td><%= lastName %>, <%= firstName %></td>" +
                            "<td><%= twitter %></td>" +
                            "<td><%= github %></td>" +
                            "</tr>");
                    return template(person);
                };
                this.tblStart = function() {
                    return "<table class='table table-condensed table-striped'>" +
                            "<thead>" +
                            "<tr>" +
                            "<th></th>" +
                            "<th>Name</th>" +
                            "<th>Twitter</th>" +
                            "<th>GitHub</th>" +
                            "</tr>" +
                            "</thead>" +
                            "<tbody>";
                };
                this.tblEnd = function() {
                    return "</tbody></table>";
                };
                this.buildTable = function() {
                    this.people = this.people ? this.people : [];
                    var result = [];
                    result.push(this.tblStart());
                    for (var i=0;i<this.people.length;i++) {
                        result.push(this.tmpl(this.people[i]));
                    }
                    result.push(this.tblEnd());
                    return result.join("");
                };
                this.remove = function() {
                    $.each($("input[type='checkbox'] :checked"), function() {
                        console.log(this);
                    });
                };
            }
        </script>

        <script data-type="People" data-instance="people"
                data-url="api/person"></script>

        <script data-type="Person" data-instance="person" data-url="api/person/#{this.id}"
                data-props="dependsOn:'people', progressIndicator:'true'"></script>

        <script data-controller="uiController" data-instance="vc">
            var ViewController = function() {
                this.onShow = function(node, instance) {
                    if (node.id == 'list') {
                        people.$get();
                    }
                }
            };
        </script>

        <div data-widget="view" id="list" data-main="true" class="page">
            <h2>People List</h2>
            <div>
                <button onclick="#{avatar.navigateTo('#new')}">
                    <i class="glyphicon glyphicon-plus"></i>
                    New
                </button>
                <hr/>
            </div>
            <div>
                #{people.buildTable()}
            </div>
            <div>
                <button onclick="#{people.remove()}">Remove</button>
            </div>
        </div>

        <div data-widget="view" id="new" class="page">
            <h2>New Person</h2>
            <div>
                <button onclick="#{avatar.navigateTo('#list')}">
                    <i class="glyphicon glyphicon-arrow-left"></i>
                    Back
                </button>
                <hr/>
            </div>
            <form>
                <label for="firstName">First Name: </label>
                <input type="text" id="firstName" data-value="#{person.firstName}">
                <br/>
                <label for="lastName">Last Name: </label>
                <input type="text" id="lastName"  data-value="#{person.lastName}">
                <br/>
                <label for="twitter">Twitter: </label>
                <input type="text" id="twitter"  data-value="#{person.twitter}">
                <br/>
                <label for="github">GitHub: </label>
                <input type="text" id="github"  data-value="#{person.github}">
                <br/>
                <div class="gutter">
                    <button onclick="#{person.save()}">Save!</button>
                </div>
            </form>
        </div>
    </body>
</html>


